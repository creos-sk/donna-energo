---
import { UIComponents } from "../ui";
import { useDesign } from "../../utils/useDesign";
import site from "../../config/site.json";
import articlesConfig from "../../config/articles.json";

const { Heading, Text, Link, Image } = UIComponents;

const {
  title,
  coverImage,
  excerpt,
  slug,
  class: wrapperClass = "",
  date,
  author,
} = Astro.props;

const articleUrl = `/articles/${slug}`;
const designWrapper = useDesign(
  "articleItem.wrapper",
  "group rounded-lg overflow-hidden bg-white shadow-sm hover:shadow-lg transition-all duration-300 hover:-translate-y-0.5"
);
const headingClass = useDesign("articleItem.titleClass", "text-lg font-semibold leading-snug text-slate-800");
const excerptClass = useDesign("articleItem.excerptClass", "text-base text-slate-600");
const imageClass = useDesign("articleItem.imageClass", "w-full h-full object-cover transition-transform duration-500 group-hover:scale-105");
const readMoreText = articlesConfig.defaultReadMoreText?.trim() || useDesign("articles.defaultReadMoreText");
const authorText = author || articlesConfig.defaultAuthor;
const formattedDate = new Date(date).toLocaleDateString(site.locale, { year: "numeric", month: "short", day: "numeric" });
---
<article class={`w-full ${wrapperClass} ${designWrapper}`}>
  
  {coverImage && (
    <div class="relative">
      <Link href={articleUrl} aria-label={`Open the article: ${title}`} class="block">
        <!-- Fixed aspect ratio image -->
        <div class="aspect-[1.618/1] overflow-hidden">
          <Image
            src={coverImage}
            alt={title}
            class={imageClass}
            size="full"
          />
        </div>

        <!-- Overlay -->
        <div
          class="absolute inset-0 flex items-center justify-center bg-black/0 group-hover:bg-black/40 
                     transition-all duration-300 pointer-events-none"
        >
          <span
            class="text-white text-sm font-medium opacity-0 translate-y-2
                   group-hover:opacity-100 group-hover:translate-y-0 transition-all duration-300
                   px-3 py-1 bg-black/70 rounded"
          >
            {readMoreText}
          </span>
        </div>
      </Link>
    </div>
  )}

  <div class="px-6 py-4 flex flex-col">
    <p class="text-xs text-gray-500 mb-1">{formattedDate} &middot; {authorText}</p>

    <Heading level="3" class={`mb-2 ${headingClass}`}>
      <Link href={articleUrl} class="hover:underline decoration-1 decoration-gray-400 underline-offset-5">
        {title}
      </Link>
    </Heading>

    {excerpt && (
      <Text class={`${excerptClass} line-clamp-3 mb-3`}>
        {excerpt.trim()}
      </Text>
    )}

    <!-- Optional text read more -->
    <Link
      href={articleUrl}
      class="text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors sm:hidden"
    >
      {readMoreText} â†’
    </Link>
  </div>
</article>
