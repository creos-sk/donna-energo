---
import Image from "../atoms/Image.astro";
import Heading from "../atoms/Heading.astro";
import Text from "../atoms/Text.astro";
import Button from "../atoms/Button.astro";           
import { useDesign } from "../../utils/useDesign";

const {
  layout = 1,
  blocks = [],
  background,
  contentWidth,
  class: wrapperClass
} = Astro.props;

const spacingClass = useDesign("section.spacing", "py-10");
const bgClass = background || useDesign("section.background", "bg-white");
const maxWidthClass = contentWidth || useDesign("layout.defaultMaxWidth", "max-w-4xl");
const alignmentClass = useDesign("section.textAlignment.center", "text-center");

const gridColsMap = useDesign("section.gridCols", {
  1: "grid-cols-1",
  2: "grid-cols-2",
  3: "grid-cols-3",
  4: "grid-cols-4",
});
const gridCols = gridColsMap[layout] || "grid-cols-1";

const headingClass = useDesign("section.typography.heading", "text-xl font-semibold mb-2");
const textClass = useDesign("section.typography.text", "text-base text-gray-600");
---
<div class={`w-full ${spacingClass} ${bgClass} ${wrapperClass || ""}`}>
  <div class={`${maxWidthClass} mx-auto`}>
    <div class={`grid gap-24 md:gap-6 grid-cols-1 md:${gridCols}` }>
{blocks.map((block) => (
  <div class={`flex flex-col items-center ${block.textCenter ? "text-center" : alignmentClass}`}>

    {block.image && (
      <Image src={block.image} alt={block.title} class="shadow-none mb-4 max-w-[128px]" />
    )}

    {block.title && (
      <Heading
        level="3"
        class={`${headingClass} ${block.headingClass || ""}`}
      >
        {block.title}
      </Heading>
    )}

    {block.text && (
      <Text
        class={`${textClass} ${block.textClass || ""} ${block.textCenter ? "text-center" : "text-left"}`}
      >
        {block.text}
      </Text>
    )}

    <!-- ðŸ”¥ BUTTON - inside the card section -->
    {block.button?.label && (
      <div class={useDesign("section.buttonWrapper", "mt-6 flex justify-center")}>
        <Button
          href={block.button.href || "#"}
          variant={block.button.variant || "primary"}
        >
          {block.button.label}
        </Button>
      </div>
    )}

  </div>
))}
    </div>
  </div>
</div>
